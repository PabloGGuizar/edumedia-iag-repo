<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <title>Repositorio de aplicaciones educativas</title>

  <!-- tailwind: activar modo oscuro por clase ANTES de cargar tailwind -->
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- aplicar tema lo antes posible para evitar parpadeo -->
  <script>
    (function () {
      const STORAGE_KEY = 'theme-preference';
      const saved = localStorage.getItem(STORAGE_KEY) || 'auto';
      const mq = window.matchMedia('(prefers-color-scheme: dark)');
      function apply(theme) {
        const useDark = theme === 'dark' || (theme === 'auto' && mq.matches);
        document.documentElement.classList.toggle('dark', useDark);
        const meta = document.querySelector('meta[name="theme-color"]') || document.createElement('meta');
        meta.setAttribute('name','theme-color');
        meta.setAttribute('content', useDark ? '#0b1220' : '#ffffff');
        if (!meta.parentNode) document.head.appendChild(meta);
      }
      apply(saved);
      mq.addEventListener?.('change', () => {
        if ((localStorage.getItem(STORAGE_KEY) || 'auto') === 'auto') apply('auto');
      });
      window.__setTheme = (v) => {
        localStorage.setItem(STORAGE_KEY, v);
        apply(v);
      };
    })();
  </script>

  <!-- librerías existentes -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="estilos.css" />
</head>

<!-- clases base + variantes oscuras -->
<body class="text-gray-800 bg-white dark:bg-gray-900 dark:text-gray-100">

  <div class="container mx-auto p-4 md:p-8">

    <!-- cabecera (añadidas variantes dark) -->
    <header class="text-center mb-4 p-6 rounded-xl bg-gradient-to-b from-blue-50 to-gray-50 dark:from-gray-900 dark:to-gray-800">
      <!-- … contenido original sin cambios … -->
      <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
        <!-- … -->
      </p>
    </header>

    <!-- barra superior con selector de tema -->
    <div class="flex flex-col md:flex-row gap-4 items-center mb-4">
      <!-- … aquí va tu buscador/filtros originales … -->

      <!-- selector de tema -->
      <div class="flex items-center gap-2 ml-auto">
        <label for="theme-select" class="text-sm font-medium text-gray-600 dark:text-gray-300">Tema:</label>
        <select id="theme-select"
                class="text-sm rounded-lg border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 py-1 px-2 bg-white text-gray-800 dark:bg-gray-800 dark:text-gray-100">
          <option value="auto" selected>Sistema (por defecto)</option>
          <option value="light">Claro</option>
          <option value="dark">Oscuro</option>
        </select>
      </div>
    </div>

    <!-- paneles, tarjetas y resto del contenido -->
    <!-- añade en tus bloques principales variantes como:
         dark:bg-gray-800 dark:text-gray-100 dark:border-gray-700 -->
    <!-- … contenido original sin cambios … -->

    <!-- ejemplo de caja de visitas (sin cambios funcionales) -->
    <div id="visit-box" class="mt-6">
      <span id="visit-total">–</span> visitas
    </div>

  </div>

  <!-- modal (añade variantes dark a tu CSS o aquí con clases) -->
  <div id="stats-modal" class="modal-overlay">
    <div class="modal-content dark:bg-gray-800 dark:text-gray-100">
      <button id="modal-close-btn" class="modal-close-btn dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700">&times;</button>
      <iframe id="modal-iframe" src="about:blank" frameborder="0" title="Panel de Estadísticas"></iframe>
    </div>
  </div>

  <!-- tu js -->
  <script src="script.js"></script>

  <!-- inicializar el selector (puede ir aquí o dentro de script.js) -->
  <script>
    (function () {
      const STORAGE_KEY = 'theme-preference';
      const sel = document.getElementById('theme-select');
      if (!sel) return;
      const saved = localStorage.getItem(STORAGE_KEY) || 'auto';
      sel.value = saved;
      sel.addEventListener('change', () => {
        const v = sel.value;
        window.__setTheme && window.__setTheme(v);
      });
    })();
  </script>
</body>
</html>
